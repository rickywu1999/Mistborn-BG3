//Iron Pull
new entry "IronPull_Container"
type "SpellData"
data "SpellType" "Target"
data "ContainerSpells" "IronPull_Base;IronPull_Enhance;IronPull_Flare"
data "DisplayName" "h3b2cd238c21d4db28bef7fe96bb89b70ef0f;2"
data "Description" "h60f624c94fd442889ca84e20255d8dbe1gcd;2"
data "DescriptionParams" "Distance(5)"
data "TooltipDamageList" "DealDamage(1d4+WisdomModifier,Bludgeoning);"
data "Icon" "Spell_Physical_Iron_Pull"
data "SpellProperties" "RemoveStatus(SLEEP);RemoveStatus(SLEEPING);RemoveStatus(SG_Sleeping);"
data "TargetRadius" "18"
data "UseCosts" "ActionPoint:1;MetalReserves:1"
data "SpellRoll" "SpellAutoResolveOnAlly(Ability.Strength, SourceSpellDC(),true)"
data "TargetConditions" "not Self() and IsMovable() and not Grounded() and not Tagged('GASEOUS_FORM') and not Tagged('CANT_SHOVE_THROW') and (Character() or Item()) and (MistbornIsMetal() or HasPassive('Iron_Savant',context.Source)) and (MistbornSizeEqualOrSmaller(context.Source.Size) or HasPassive('Iron_Savant',context.Source))"
data "TooltipAttackSave" "Strength"
data "PrepareSound" "Generic_GeneralAction_Start"
data "PrepareLoopSound" "Generic_GeneralAction_Loop"
data "CastSound" "Action_Cast_Shove"
data "CastTextEvent" "Cast"
data "SpellAnimation" "3ff87abf-1ea1-4c32-aadf-c822d74c7dc0,,;,,;70a28457-dba7-46f7-b03c-ceb3b9e12bad,,;68868848-6341-448a-97e3-94aa43ad5faf,,;d8925ce4-d6d9-400c-92f5-ad772ef7f178,,;,,;eadedcce-d01b-4fbb-a1ae-d218f13aa5d6,,;,,;,,"
data "VerbalIntent" "Damage"
data "SpellFlags" "AddFallDamageOnLand;IsHarmful;IsLinkedSpellContainer;HasHighGroundRangeExtension"
data "HitAnimationType" "PhysicalDamage"
data "SpellAnimationIntentType" "Aggressive"
data "PrepareEffect" "e86ad080-a3c1-41c1-97ed-4511edc072ae"
data "TargetEffect" "ced3624d-cad9-48bd-a487-828cb374ce7b"
data "BeamEffect" "61b2a0b0-c185-4a9f-aaeb-ef05f230bd37"
data "SpellSoundMagnitude" "Small"
data "CycleConditions" "Character() and not Grounded()"
data "Sheathing" "Sheathed"
data "RequirementConditions" "not HasStatus('IRON_DRAINED') and HasPassive('Iron_Unlock',context.Source)"

new entry "IronPull_Base"
type "SpellData"
data "SpellType" "Target"
using "IronPull_Container"
data "SpellContainerID" "IronPull_Container"
data "SpellSuccess" "IF(not Ally()):Force(-5,OriginToEntity,Aggressive);IF(Ally()):Force(-5,OriginToEntity,Friendly);IF(not Ally()):DealDamage(1d4+WisdomModifier,Bludgeoning,Nonmagical);IF(not Ally() and HasPassive('Iron_Savant',context.Source)):DealDamage(1d4,Bludgeoning,Nonmagical)"

new entry "IronPull_Enhance"
type "SpellData"
data "SpellType" "Target"
using "IronPull_Container"
data "SpellContainerID" "IronPull_Container"
data "Icon" "Spell_Physical_Iron_Pull_Enhance"
data "SpellSuccess" "IF(not Ally()):Force(-10,OriginToEntity,Aggressive);IF(Ally()):Force(-10,OriginToEntity,Friendly);IF(not Ally()):DealDamage(1d8+WisdomModifier,Bludgeoning,Nonmagical);IF(not Ally() and HasPassive('Iron_Savant',context.Source)):DealDamage(1d8,Bludgeoning,Nonmagical)"
data "TooltipDamageList" "DealDamage(1d8+WisdomModifier,Bludgeoning);"
data "UseCosts" "ActionPoint:1;MetalReserves:2"
data "DisplayName" "h5487181d0d2340d7bedac6f77927d8f7125g;2"
data "Description" "h60f624c94fd442889ca84e20255d8dbe1gcd;2"
data "DescriptionParams" "Distance(10)"

new entry "IronPull_Flare"
type "SpellData"
data "SpellType" "Target"
using "IronPull_Container"
data "SpellContainerID" "IronPull_Container"
data "Icon" "Spell_Physical_Iron_Pull_Flare"
data "RequirementConditions" "HasPassive('Metal_Flaring') and not HasStatus('IRON_DRAINED') and HasPassive('Iron_Unlock',context.Source)"
data "SpellSuccess" "IF(not Ally()):Force(-15,OriginToEntity,Aggressive);IF(Ally()):Force(-15,OriginToEntity,Friendly);IF(not Ally()):DealDamage(1d12+WisdomModifier,Bludgeoning,Nonmagical);IF(not Ally() and HasPassive('Iron_Savant',context.Source)):DealDamage(1d12,Bludgeoning,Nonmagical)"
data "TooltipDamageList" "DealDamage(1d12+WisdomModifier,Bludgeoning);"
data "UseCosts" "ActionPoint:1;MetalReserves:4"
data "DisplayName" "h1aa4b50a3431448a86cdea0c3c73373de4df;2"
data "Description" "h60f624c94fd442889ca84e20255d8dbe1gcd;2"
data "DescriptionParams" "Distance(15)"





// Iron Lurch
new entry "IronLurch_Container"
type "SpellData"
data "SpellType" "Target"
data "ContainerSpells" "IronLurch_Base;IronLurch_Enhance;IronLurch_Flare"
data "DisplayName" "h89d94da3bcd941ee81d8942b4ac8a068d63e;2"
data "Description" "h90140284a0f0416ba73df128dccefb04aa15;2"
data "SpellProperties" "GROUND:TeleportSource(true,true)"
data "Icon" "Spell_Physical_Iron_Lurch"
data "TargetRadius" "5"
data "TargetConditions" "not Self() and not Tagged('GASEOUS_FORM') and (Character() or Item()) and (MistbornIsMetal() or HasPassive('Iron_Savant',context.Source)) and (MistbornSizeEqualOrGreater(context.Source.Size) or HasPassive('Iron_Savant',context.Source))"
data "UseCosts" "BonusActionPoint:1;MetalReserves:1"
data "SpellFlags" "IsJump;IsLinkedSpellContainer;HasHighGroundRangeExtension"
data "SpellAnimation" "3ff87abf-1ea1-4c32-aadf-c822d74c7dc0,,;,,;70a28457-dba7-46f7-b03c-ceb3b9e12bad,,;68868848-6341-448a-97e3-94aa43ad5faf,,;d8925ce4-d6d9-400c-92f5-ad772ef7f178,,;,,;eadedcce-d01b-4fbb-a1ae-d218f13aa5d6,,;,,;,,"
data "PrepareEffect" "e86ad080-a3c1-41c1-97ed-4511edc072ae"
data "BeamEffect" "61b2a0b0-c185-4a9f-aaeb-ef05f230bd37"
data "TargetEffect" "ced3624d-cad9-48bd-a487-828cb374ce7b"
data "PrepareSound" "Generic_Prepare_Jump"
data "PrepareLoopSound" "Generic_GeneralAction_Loop"
data "CastSound" "Action_Cast_Jump"
data "CastTextEvent" "Cast"
data "VerbalIntent" "Damage"
data "CycleConditions" "Character()"
data "Sheathing" "Sheathed"
data "RequirementConditions" "not HasStatus('IRON_DRAINED') and HasPassive('Iron_Unlock',context.Source)"

new entry "IronLurch_Base"
type "SpellData"
data "SpellType" "Target"
using "IronLurch_Container"
data "SpellContainerID" "IronLurch_Container"

new entry "IronLurch_Enhance"
type "SpellData"
data "SpellType" "Target"
using "IronLurch_Container"
data "SpellContainerID" "IronLurch_Container"
data "Icon" "Spell_Physical_Iron_Lurch_Enhance"
data "TargetRadius" "10"
data "UseCosts" "BonusActionPoint:1;MetalReserves:2"
data "DisplayName" "hae1c3a6a92ff41dabddb36f9724996407bd8;2"

new entry "IronLurch_Flare"
type "SpellData"
data "SpellType" "Target"
using "IronLurch_Container"
data "SpellContainerID" "IronLurch_Container"
data "Icon" "Spell_Physical_Iron_Lurch_Flare"
data "RequirementConditions" "HasPassive('Metal_Flaring') and not HasStatus('IRON_DRAINED') and HasPassive('Iron_Unlock',context.Source)"
data "TargetRadius" "15"
data "UseCosts" "BonusActionPoint:1;MetalReserves:4"
data "DisplayName" "h5c54af2eaffd456abac381d42472cd7278g1;2"





// Iron Anchor
new entry "IronAnchor_Boost"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "h97d924c29be44e4db102e288f989d6173345;3"
data "Description" "h00376e5a93a1436e8f10a03612c562bd8931;4"
data "StackId" "IronAnchor_Boost"
data "Icon" "Spell_Physical_Iron_Anchor"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "Passives" "IronAnchor_Toggle"
data "StatusGroups" "SG_RemoveOnRespec"

new entry "IronAnchor_Toggle"
type "PassiveData"
data "DisplayName" "h97d924c29be44e4db102e288f989d6173345;3"
data "Description" "h00376e5a93a1436e8f10a03612c562bd8931;4"
data "Properties" "IsToggled;ToggledDefaultAddToHotbar"
data "Icon" "Spell_Physical_Iron_Anchor"
data "ToggleOnFunctors" "ApplyStatus(IronAnchor, 100, -1)"
data "ToggleOffFunctors" "RemoveStatus(IronAnchor)"

new entry "IronAnchor"
type "StatusData"
data "StatusType" "BOOST"
using "ENLARGE"
data "DisplayName" "h97d924c29be44e4db102e288f989d6173345;1"
data "Description" "h00376e5a93a1436e8f10a03612c562bd8931;1"
data "StatusEffect" "ead75c6a-806e-4db7-8d51-f06beca00fe2"
data "DescriptionParams" ""
data "StackId" "IronAnchor"
data "Icon" "Status_Physical_Iron_Anchor"
data "Boosts" "ObjectSize(+1)"
data "Passives" "EnlargeWeightMedium;EnlargeWeightLarge"
data "StatusGroups" "SG_RemoveOnRespec"




// Iron Redirection
new entry "IronRedirection"
type "SpellData"
data "SpellType" "Shout"
data "AreaRadius" "10"
data "SpellProperties" "ApplyStatus(IRONREDIRECTION_AURA,100,-1);ApplyStatus(IRONREDIRECTION_COUNTDOWN,100,10)"
data "TargetConditions" "Self()"
data "RequirementConditions" "HasShieldEquipped(context.Source) and not HasStatus('IRONREDIRECTION_AURA') and HasPassive('Iron_Unlock',context.Source)"
data "Icon" "Spell_Physical_Iron_Redirection"
data "DisplayName" "hb370d70c3fb84a099968d0ea58d4f8a30309;1"
data "Description" "h34fb225f00b84bfe9d4da9d6e6579cf25762;1"
data "DescriptionParams" "1d4+DexterityModifier"
data "TooltipStatusApply" "ApplyStatus(IRONREDIRECTION_AURA,100,-1)"
data "VocalComponentSound" "Vocal_Component_DetectGeneric"
data "CastTextEvent" "Cast"
data "UseCosts" "ActionPoint:1;MetalReserves:1"
data "SpellAnimation" "5e57443f-284e-47b2-915e-5b6417db269c,,;925779e7-8bf6-4d56-8c4d-42c3bc01c60c,,;50398f4e-dd82-4d6a-ad43-aedd578543d9,,;1c343e00-7e6c-4f53-b588-074a3cdb9c7d,,;5bcdefbb-2194-46c2-ac77-0b2d8472a5f7,,;,,;5fdb66be-7506-411a-a7ea-c4783288aac8,,;,,;,,"
data "VerbalIntent" "Utility"
data "HitAnimationType" "None"
data "PrepareEffect" "e50b62f4-93ad-4c5e-82d7-7f2f6e25acd4"
data "CastEffect" "ccdad0c8-4ef6-4f07-bf35-80c9a9023556"
data "Sheathing" "Melee"
data "TooltipPermanentWarnings" "3b72916a-904a-4c80-a0c3-48ce3cc69d24"
data "RequirementConditions" "not HasStatus('IRON_DRAINED') and HasPassive('Iron_Unlock',context.Source)"

new entry "IronRedirection_End"
type "SpellData"
data "SpellType" "Shout"
data "SpellProperties" "RemoveStatus(IRONREDIRECTION_AURA)"
data "Icon" "Spell_Physical_Iron_Redirection"
data "DisplayName" "hc8c9cd00588847d19fe26e544db7166510cf;1"
data "Description" "hb087aa7ac9d24efcae534035fea84708d85g;5"
data "CastSound" "Action_Cast_Rage_End"
data "CastTextEvent" "Cast"
data "UseCosts" ""
data "SpellAnimation" "22ddf59a-5e0a-41c1-840c-ae9ba5704e63,,;,,;60b207c9-6751-4144-a766-5173ddee5ec7,,;fced40ee-7eaa-4054-9354-8c1ea7fbb0eb,,;93317549-2754-4931-98ce-1d67f899318f,,;,,;9406f0da-ac4e-4d4a-b98f-798102dd300e,,;,,;,,"
data "VerbalIntent" "Utility"
data "SpellStyleGroup" "Class"
data "SpellFlags" "IsMelee"
data "SpellAnimationIntentType" "Peaceful"
data "SpellSoundMagnitude" "Big"
data "Sheathing" "Melee"

new entry "IRONREDIRECTION_AURA"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "h696325d3a7c54140a2130863523b3d54gf58;2"
data "Description" "h27db4d39940c41ac8a79866305c6d19640ae;2"
data "DescriptionParams" "1d4+DexterityModifier"
data "Icon" "Spell_Physical_Iron_Redirection"
data "SoundLoop" "Spell_Status_PassWithoutTraceAura"
data "SoundStop" "Spell_Status_PassWithoutTraceAura_Stop"
data "StackId" "IRONREDIRECTION_AURA"
data "StackPriority" "1"
data "AuraRadius" "10"
data "AuraStatuses" "TARGET:IF(Ally()):ApplyStatus(IRONREDIRECTION_PROTECTION)"
data "Boosts" "IF(not HasPassive('Iron_Savant',context.Source)):UnlockInterrupt(Interrupt_IronRedirection_Reaction);IF(HasPassive('Iron_Savant',context.Source)):UnlockInterrupt(Interrupt_IronRedirection_Reaction_Savant);UnlockSpell(IronRedirection_End);UnlockSpellVariant(SpellId('IronRedirection_End'),ModifyIconGlow())"
data "RemoveConditions" "not (HasShieldEquipped(context.Source)) or Dead()"
data "RemoveEvents" "OnEquip;OnUnequip;OnSourceDeath"
data "OnRemoveFunctors" "RemoveStatus(IRONREDIRECTION_COUNTDOWN)"
data "TickType" "StartTurn"
data "TickFunctors" "IF(not HasActionResource('MetalReserves',1,0,false,true,context.Source) and not HasStatus('IRONREDIRECTION_COUNTDOWN')):RemoveStatus(IRONREDIRECTION_AURA);IF(not HasStatus('IRONREDIRECTION_COUNTDOWN')):UseActionResource(MetalReserves,1);IF(not HasStatus('IRONREDIRECTION_COUNTDOWN')):ApplyStatus(IRONREDIRECTION_COUNTDOWN,100,10);"
data "StatusGroups" "SG_RemoveOnRespec"
data "StatusEffect" "50bda400-f36a-4590-bdd0-1dc5a89dd5eb"

new entry "IRONREDIRECTION_COUNTDOWN"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "hb370d70c3fb84a099968d0ea58d4f8a30309;2"
data "Description" ""
data "Icon" "Spell_Physical_Iron_Redirection"
data "StackId" "IRONREDIRECTION_COUNTDOWN"
data "TickType" "StartTurn"
data "StatusGroups" "SG_RemoveOnRespec"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"

new entry "IRONREDIRECTION_PROTECTION"
type "StatusData"
data "StatusType" "BOOST"
data "Icon" "Spell_Physical_Iron_Redirection"
data "DisplayName" "hb370d70c3fb84a099968d0ea58d4f8a30309;2"
data "Description" "h4c595da44d704a7ba8ccad4fddf6755e3a23;2"
data "StatusEffect" "1bbbbd67-046e-4f55-b011-e69925149d16"

new entry "Interrupt_IronRedirection_Reaction"
type "InterruptData"
data "DisplayName" "hb370d70c3fb84a099968d0ea58d4f8a30309;1"
data "Description" "hd3668c88f423412a99fb69aeb907da189d9g;1"
data "DescriptionParams" "1d4+DexterityModifier"
data "Icon" "Spell_Physical_Iron_Redirection"
data "InterruptContext" "OnPostRoll"
data "InterruptContextScope" "Nearby"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and HasShieldEquipped(context.Observer) and not Self(context.Source,context.Observer) and not Self(context.Target,context.Observer) and Ally(context.Target, context.Observer) and Enemy(context.Source, context.Observer) and IsRangedWeaponAttack() and HasStatus('IRONREDIRECTION_PROTECTION',context.Target) and not AnyEntityIsItem() and CanSee(context.Observer, context.Source) and not DistanceToEntityGreaterThan(18, context.ObserverPosition, context.Source) and HasInterruptedAttack() and IsRerollInterruptInteresting(context.Source)"
data "Properties" "Counterspell();ApplyStatus(OBSERVER_SOURCE,IRONREDIRECTION_ACTIVATED,100,0);ApplyStatus(OBSERVER_OBSERVER,IRONREDIRECTION_MITIGATION,100,1);"
data "Cost" "ReactionActionPoint:1;MetalReserves:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "HasShieldEquipped(context.Source) and (not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER'))"
data "EnableContext" "OnStatusApplied;OnStatusRemoved;OnEquip"

new entry "Interrupt_IronRedirection_Reaction_Savant"
type "InterruptData"
data "DisplayName" "hb370d70c3fb84a099968d0ea58d4f8a30309;1"
data "Description" "hd3668c88f423412a99fb69aeb907da189d9g;1"
data "DescriptionParams" "1d4+DexterityModifier"
data "Icon" "Spell_Physical_Iron_Redirection"
data "InterruptContext" "OnPostRoll"
data "InterruptContextScope" "Nearby"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and HasShieldEquipped(context.Observer) and not Self(context.Source,context.Observer) and not Self(context.Target,context.Observer) and Ally(context.Target, context.Observer) and Enemy(context.Source, context.Observer) and IsRangedWeaponAttack() and HasStatus('IRONREDIRECTION_PROTECTION',context.Target) and not AnyEntityIsItem() and CanSee(context.Observer, context.Source) and not DistanceToEntityGreaterThan(18, context.ObserverPosition, context.Source) and HasInterruptedAttack() and IsRerollInterruptInteresting(context.Source)"
data "Properties" "Counterspell();ApplyStatus(OBSERVER_SOURCE,IRONREDIRECTION_ACTIVATED,100,0);ApplyStatus(OBSERVER_OBSERVER,IRONREDIRECTION_MITIGATION,100,1);"
data "Cost" "MetalReserves:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "HasShieldEquipped(context.Source) and (not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER'))"
data "EnableContext" "OnStatusApplied;OnStatusRemoved;OnEquip"

new entry "IRONREDIRECTION_ACTIVATED"
type "StatusData"
data "StatusType" "BOOST"
data "Icon" "Spell_Physical_Iron_Redirection"
data "DisplayName" "hb370d70c3fb84a099968d0ea58d4f8a30309;2"
data "Description" "h4c595da44d704a7ba8ccad4fddf6755e3a23;2"

new entry "IRONREDIRECTION_MITIGATION"
type "StatusData"
data "StatusType" "BOOST"
data "Icon" "Spell_Physical_Iron_Redirection"
data "DisplayName" "hb370d70c3fb84a099968d0ea58d4f8a30309;2"
data "Description" "h4c595da44d704a7ba8ccad4fddf6755e3a23;2"
data "Boosts" "DamageReduction(All, Flat, 1d4+DexterityModifier)"
data "RemoveEvents" "OnAttacked"
data "StatusGroups" "SG_RemoveOnRespec"





// Iron Disarm
new entry "IronDisarm"
type "SpellData"
data "SpellType" "Target"
data "TargetRadius" "18"
data "SpellRoll" "not SavingThrow(Ability.Strength, SourceSpellDC())"
data "SpellSuccess" "ApplyStatus(DISARM, 100, 1)"
data "TargetConditions" "Character() and not HasPassive('ImmuneToDisarm')"
data "Icon" "Spell_Physical_Iron_Disarm"
data "DisplayName" "h60d706c025bb4834971f166fcf4ea2f56a2d;2"
data "Description" "he6aa05d79ebb4b288c04feb54a1d719e968f;3"
data "TooltipAttackSave" "Strength"
data "TooltipStatusApply" "ApplyStatus(DISARMED, 100, 1)"
data "TargetSound" "Spell_Impact_Control_CommandHalt_L1to3"
data "CastTextEvent" "Cast"
data "CycleConditions" "Enemy() and not Dead()"
data "UseCosts" "ActionPoint:1;MetalReserves:1"
data "SpellAnimation" "3ff87abf-1ea1-4c32-aadf-c822d74c7dc0,,;,,;70a28457-dba7-46f7-b03c-ceb3b9e12bad,,;68868848-6341-448a-97e3-94aa43ad5faf,,;d8925ce4-d6d9-400c-92f5-ad772ef7f178,,;,,;eadedcce-d01b-4fbb-a1ae-d218f13aa5d6,,;,,;,,"
data "VerbalIntent" "Control"
data "SpellFlags" "IsHarmful;IgnorePreviouslyPickedEntities"
data "HitAnimationType" "None"
data "PrepareEffect" "e86ad080-a3c1-41c1-97ed-4511edc072ae"
data "TargetEffect" "ced3624d-cad9-48bd-a487-828cb374ce7b"
data "BeamEffect" "61b2a0b0-c185-4a9f-aaeb-ef05f230bd37"
data "RequirementConditions" "not HasStatus('IRON_DRAINED') and HasPassive('Iron_Unlock',context.Source)"





// Allomancy Aura
new entry "ALLOMANCY_AURA"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "hcf533992g2e21g408eg8784g00f411df201b;1"
data "StackId" "ALLOMANCY_AURA"
data "StackPriority" "1"
data "AuraRadius" "18"
data "AuraStatuses" "TARGET:IF(MistbornIsMetal()):ApplyStatus(MISTBORNISMETAL)"
data "StatusGroups" "SG_RemoveOnRespec"
data "RemoveEvents" "OnAttack;OnSpellCast;OnAttacked;OnMove;OnCombatEnded"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"

new entry "MISTBORNISMETAL"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "hcf533992g2e21g408eg8784g00f411df201b;1"
data "StackId" "MISTBORNISMETAL"
data "StatusEffect" "0d4f27fa-9b6b-4e5d-9b4f-26a4911408fc"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"